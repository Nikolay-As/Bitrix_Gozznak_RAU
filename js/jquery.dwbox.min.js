(function(b){var x=!1,p=!1,y=!1,h=[],z=[],f=0,m={},u=!1,n=null,v=null,g=null,r=null,k=null,A=null,t=null,l=null,Q=function(){g.hover(function(){x=!0},function(){x=!1});v.on("click",function(a){0==x&&1==b.dwbox.options.closeOnOverlayClick&&a.target===this&&b.dwbox.close()});!0===b.dwbox.options.allowRelGallery&&D()},w=function(){v.show();E();g.fadeIn("fast");y||(y=!0,b(window).on("scroll",F),b(window).on("resize",G),0!=h.length&&(b(document).on("keydown",H),b.dwbox.options.hideControls&&(g.on("mouseenter",
I),g.on("mouseleave",J))));b.dwbox.adjust()},K=function(){l.hide();r.hide();g.fadeOut("fast",function(){B(h[f])})},D=function(){b('a[rel ^= "dw-gallery"]').click(function(a){var c;a.preventDefault();a=b(this).attr("rel");a=b('a[rel="'+a+'"]');c=b(this).attr("href");0<a.length&&b.dwbox.load(a,c)})},B=function(a){if("string"!=typeof a||0==a.length)return!1;var c=new Image;c.onload=R;c.onerror=C;c.src=a;c.style.display="block";n="gallery";k.empty();k.append(c);w();b.dwbox.setloading()},L=function(a){if("string"!=
typeof a||0==a.length)return!1;n="resource";try{b.ajax({type:"POST",url:a,success:function(a){k.empty();k.html(a);w()},error:C})}catch(c){C()}},M=function(a){if("string"!=typeof a||0==a.length)return!1;n="html";a=b(a);k.empty();k.append(a);w()},N=function(a){if("string"!=typeof a||0==a.length)return!1;n="iframe";a=b("<iframe/>",{id:"dw-iframe","class":"dwbox_iframe",frameborder:0,hspace:0,scrolling:"auto",src:a});k.empty();k.append(a);w()},q=function(a){var b;if(0==a.length)return!1;try{b=a.match(/^.+\.([a-z0-9]+)(\?.*)?$/i)[1].toLowerCase();
switch(b){case "png":case "jpg":case "jpeg":case "gif":case "svg":return"image";case "html":case "php":case "js":case "css":return"resource"}return"unsupported"}catch(d){return RegExp(/^https?\:\/\/.+$/i).test(a)?"iframe":!1}},O=function(){var a,b,d,e,f;a=window.innerWidth;b=window.innerHeight;g.width();g.height();switch(n){case "gallery":d=k.find("img"),imageRatio=m.height/m.width,d.width(),d.height(),m.width<a-40&&m.height<b-40?(a=m.width,e=m.height):(a-=40,f=b-40,e=a*imageRatio,e>b-40&&(e=f,a=
e/imageRatio)),d.css({width:a+"px",height:e+"px"})}},E=function(){p||r.stop().css("opacity",1).show();0==f&&(A.hide(),0==h.length&&t.hide());f==h.length-1&&t.hide()},P=function(){var a;if(u)return!1;if(!p){l.stop().css("opacity",1).hide();l.hide();l.empty();if(0==h.length)return!1;a="";try{a=z[f]}catch(b){return!1}"string"==typeof a&&""!=a&&(l.html(a),l.show())}},H=function(a){a.stopImmediatePropagation();switch(a.keyCode){case 37:0<f&&b.dwbox.prev();break;case 39:f<h.length-1&&b.dwbox.next();break;
case 27:b.dwbox.close()}return!1},F=function(a){b.dwbox.adjust()},G=function(a){1==b.dwbox.options.resizeWrapToFitTheScreen&&O();b.dwbox.adjust()},I=function(a){p=!1;E();P()},J=function(a){r.fadeOut("slow",function(){p=!0});l.fadeOut("slow")},R=function(){u=!1;"gallery"==n&&(m={width:this.width,height:this.height});b.dwbox.stoploading();P()},C=function(){u=!0;k.html('<div class="dwbox_error">\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u0430!</div>');
b.dwbox.stoploading()};b.dwbox=function(){};b.dwbox.options={closeOnOverlayClick:!0,resizeWrapToFitTheScreen:!0,allowRelGallery:!0,hideControls:!1};b.dwbox.init=function(){b("body").append('\t\t\t<div class="dwbox_overlay" style="display: none;"></div>\t\t\t<div class="dwbox_wrap" style="display: none;">\t\t\t\t<div class="dwbox_card">\t\t\t\t\t<div class="dwbox_ctrl dwbox_btn_close" onclick="$.dwbox.close();"></div>\t\t\t\t\t<div class="dwbox_ctrl dwbox_btn_prev" onclick="$.dwbox.prev();"></div>\t\t\t\t\t<div class="dwbox_ctrl dwbox_btn_next" onclick="$.dwbox.next();"></div>\t\t\t\t\t<div class="dwbox_content"></div>\t\t\t\t\t<div class="dwbox_title" style="display: none;"></div>\t\t\t\t</div>\t\t\t</div>\t\t');
v=b("div.dwbox_overlay");g=b("div.dwbox_wrap");r=b("div.dwbox_ctrl");k=b(".dwbox_content");b(".dwbox_btn_close");A=b(".dwbox_btn_prev");t=b(".dwbox_btn_next");l=b(".dwbox_title");Q()};b.dwbox.setloading=function(){g.addClass("loading");g.css("width","0px").css("height","0px");b.dwbox.adjust()};b.dwbox.stoploading=function(){g.hasClass("loading")&&(g.removeClass("loading"),g.css("width","auto").css("height","auto"),b.dwbox.adjust(!1),1==b.dwbox.options.resizeWrapToFitTheScreen&&O(),b.dwbox.adjust())};
b.dwbox.adjust=function(a){var c,d,e,f,h;e=b(window).scrollLeft();f=b(window).scrollTop();c=document.documentElement.clientWidth;d=document.documentElement.clientHeight;!1===a&&(c=window.innerWidth,d=window.innerHeight);h=g.width();a=g.height();c=.5*(c-h);0>c&&(c=0);0<e&&(c+=e);e=.5*(d-a)+f;0>e&&(e=0);a>d&&(e=f+20);g.css("left",c+"px").css("top",e+"px");l.css("width",h-(parseInt(l.css("paddingLeft"))+parseInt(l.css("paddingRight")))+"px");d=t.height();d=.5*a-d/2;t.css("top",d+"px");A.css("top",d+
"px")};b.dwbox.close=function(){l.stop().css("opacity",1).hide();r.stop().css("opacity",1).show();f=0;v.hide();g.hide();k.html("");h=[];z=[];n=null;p=u=y=!1;b(window).off("scroll",F);b(window).off("resize",G);b(document).off("keydown",H);b.dwbox.options.hideControls&&(g.off("mouseenter",I),g.off("mouseleave",J))};b.dwbox.next=function(){f<h.length-1&&(f++,K(h[f]))};b.dwbox.prev=function(){0<f&&(f--,K(h[f]))};b.dwbox.load=function(a,c,d){var e,g,k,l,m,n;"undefined"!=typeof d&&b.isArray(d)||(d=[]);
if(b.isArray(a)&&0<a.length){for(e=0;e<a.length;e++)"image"==q(a[e])&&h.push(a[e]),d.length==a.length&&z.push(d[e]);"undefined"!=typeof c&&"image"==q(c)&&0<=b.inArray(c,h)&&(f=h.indexOf(c));B(h[f])}else if("string"==typeof a)try{e=[";",","],g=b.inArray(a.match(/^.+(,|;).*$/i)[1],e),b.dwbox.load(a.split(e[g]),c,d)}catch(p){"image"==q(a)?b.dwbox.load([a],c,d):"resource"==q(a)?L(a):"iframe"==q(a)?N(a):M(a)}else"object"==typeof a&&0<a.length&&(a.is("a")||a.is("img"))&&(k=[],l=[],a.each(function(){m=b(this).attr(a.is("a")?
"href":"src");n=b(this).attr("title")||b(this).attr("alt")||"";"image"===q(m)&&l.push(m);a.length!==d.length&&k.push(n)}),a.length===d.length&&(k=d),0<l.length&&b.dwbox.load(l,c,k))};b.dwbox.loadIframe=function(a){N(a)};b.dwbox.loadHtml=function(a){M(a)};b.dwbox.loadImage=function(a){B(a)};b.dwbox.loadResource=function(a){L(a)};b.dwbox.refreshRelGallery=function(){!0===b.dwbox.options.allowRelGallery&&D()};b(document).ready(function(){b.dwbox.init()})})(jQuery);